# name: Auto Deploy MkDocs to Firebase

# on:
#   push:
#     branches:
#       - main

# jobs:
#   build-deploy:
#     runs-on: windows-latest   # or ubuntu-latest if you prefer Linux

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Set up Python
#         uses: actions/setup-python@v5
#         with:
#           python-version: '3.10'

#       - name: Install MkDocs
#         run: py -m pip install mkdocs mkdocs-material pymdown-extensions mkdocs-glightbox-plugin mkdocs-awesome-pages-plugin mkdocs-minify-plugin

#       - name: Build MkDocs
#         run: py -m mkdocs build --clean

#       - name: Install Firebase CLI
#         run: npm install -g firebase-tools@latest

#       - name: Deploy to Firebase Hosting
#         env:
#           FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
#         run: firebase deploy --only hosting --token "$FIREBASE_TOKEN"

# Build MkDocs and deploy to Firebase Hosting using a firebase CI token stored in the repo secret FIREBASE_TOKEN.
# Trigger: push to main
#
# Requirements:
# - firebase.json (hosting.public must be "public") and .firebaserc at repo root
# - A repository secret named FIREBASE_TOKEN containing the string returned by `firebase login:ci`
#
name: Deploy MkDocs to Firebase Hosting (FIREBASE_TOKEN)

on:
  push:
    branches:
      - main

concurrency:
  group: deploy-mkdocs-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # - name: Cache pip
      #   uses: actions/cache@v4
      #   with:
      #     path: ~/.cache/pip
      #     key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
      #     restore-keys: |
      #       ${{ runner.os }}-pip-

      - name: Install Python dependencies
        run: |
          py -m pip install --upgrade pip
          if [ -f requirements.txt ]; then
            py -m pip install -r requirements.txt
          else
            py -m pip install mkdocs mkdocs-material pymdown-extensions mkdocs-glightbox-plugin mkdocs-awesome-pages-plugin mkdocs-minify-plugin
          fi

      - name: Build MkDocs site (output -> public)
        run: py -m mkdocs build --site-dir public

      - name: Set up Node (for firebase-tools)
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install firebase-tools
        run: npm install -g firebase-tools

      - name: Deploy to Firebase Hosting
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
        run: firebase deploy --only hosting --project learning-devbase --non-interactive


# name: Deploy MkDocs to Firebase Hosting

# on:
#   push:
#     branches:
#       - main

# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v4

#       - name: Set up Python
#         uses: actions/setup-python@v4
#         with:
#           python-version: '3.x'

#       - name: Install dependencies
#         run: |
#           if [ -f requirements.txt ]; then
#             py -m pip install --upgrade pip
#             py -m pip install -r requirements.txt
#           else
#             py -m pip install --upgrade pip
#             py -m pip install mkdocs mkdocs-material pymdown-extensions mkdocs-glightbox-plugin mkdocs-awesome-pages-plugin mkdocs-minify-plugin
#           fi

#       - name: Build MkDocs public
#         run: py -m mkdocs build --site-dir public

#       # - name: Install Firebase CLI
#       #   run: npm install -g firebase-tools

#       - name: Deploy to Firebase Hosting
#         env:
#           FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
#         run: firebase deploy --token "$FIREBASE_TOKEN"

#       # - name: Deploy to Firebase Hosting
#       #   uses: w9jds/firebase-action@v2
#       #   with:
#       #     args: deploy --only hosting
#       #   env:
#       #     FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}